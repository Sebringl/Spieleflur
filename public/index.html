<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Spieleflur</title>
  <link rel="icon" href="/icon.png" sizes="1024x1024" type="image/png" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="robots" content="noindex, nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet" href="/css/main.css" />
</head>
<body>
  <div class="theme-toggle" role="group" aria-label="Darstellung umschalten">
    <label for="themeToggle">Dunkelmodus</label>
    <input type="checkbox" id="themeToggle" />
  </div>

  <!-- Seitenkopf mit dynamischem Logo je Spieltyp -->
  <h1 id="pageTitle" class="page-title">
    <img id="pageTitleLogo" class="page-title-logo" src="/header_Lobby.png" alt="Spieleflur Lobby" />
    <span id="pageTitleText" class="visually-hidden">Spieleflur (Lobby)</span>
  </h1>

  <!-- Lobby-Ansicht: Spiel erstellen/beitreten und Lobby-Status -->
  <div id="lobby">
    <div id="lobbyCard">
      <!-- Spieltyp-Einstellungen (nur Host Ã¤ndert) -->
      <div class="toggle-row" role="group" aria-label="Spieltyp Einstellungen">
        <label for="gameTypeSelect">Spieltyp</label>
        <select id="gameTypeSelect">
          <option value="schocken">Schocken</option>
          <option value="kniffel">Yahtzee</option>
          <option value="kwyx">Kwyx</option>
          <option value="schwimmen">Schwimmen</option>
          <option value="skat">Skat</option>
          <option value="schiffeversenken">Schiffe versenken</option>
        </select>
        <label class="deckel-inline" for="deckelToggle">
          <input type="checkbox" id="deckelToggle" />
          <span>Mit Deckeln spielen</span>
        </label>
        <label class="deckel-inline" for="kniffelHandBonusToggle">
          <input type="checkbox" id="kniffelHandBonusToggle" checked />
          <span>Hand: +5 Punkte</span>
        </label>
      </div>

      <hr />
      <!-- Rejoin-Box: gespeicherten Lobby-Login wiederverwenden -->
      <div id="rejoinBox" style="display:none;">
        <h3>Wieder beitreten</h3>
        <div class="small">Wir haben ein gespeichertes Room-Login gefunden.</div>
        <button id="btnRejoin">Wieder beitreten</button>
        <button id="btnForget" class="btn-secondary">Vergessen</button>
      </div>

      <hr />
      <h3>Spiel beitreten oder erstellen</h3>
      <div class="small muted" style="margin-bottom: 10px;">Name eingeben, Code wÃ¤hlen und loslegen (bei bestehender Lobby bestÃ¤tigt der Host).</div>
      <input id="playerName" class="text-input centered" type="text" placeholder="Dein Name" autocomplete="nickname" />
      <div class="code-input-row">
        <input id="roomCode" class="text-input" type="text" placeholder="Room-Code (z.B. K7F3Q)" autocomplete="off" />
        <button id="btnNewCode" class="icon-btn" title="Neuen Code erzeugen" aria-label="Neuen Code erzeugen">
          <span>ðŸ”„</span>
        </button>
      </div>
      <button id="btnEnter" class="centered">Los!</button>
      <div id="joinStatus" class="small muted" style="margin-top: 6px;"></div>

      <hr />
      <!-- Ã–ffentliche Lobby-Liste (nur wenn man nicht in einer Lobby ist) -->
      <div class="lobby-list" id="activeLobbies">
        <div class="small muted">Aktive Lobbys werden geladenâ€¦</div>
      </div>

      <hr />
      <!-- Eigene Lobby-Details (sichtbar sobald man in einer Lobby ist) -->
      <div id="roomView" style="display:none;">
        <h3>Room</h3>
        <div class="codeBig" id="roomCodeBig">------</div>
        <div class="playerList" id="playerList"></div>
        <div class="playerList" id="pendingList"></div>
        <div class="small muted" id="roomSettingsSummary" style="margin-top: 6px;"></div>
        <div id="hostControls" style="display:none; margin-top: 12px;">
          <button id="btnStartGame">Spiel starten</button>
        </div>
        <div id="leaveLobbyWrap" style="display:none; margin-top: 8px;">
          <button id="btnLeaveLobby" class="btn-secondary">Lobby verlassen</button>
        </div>
        <div id="lobbyExpiryNotice" style="display:none; margin-top: 12px;">
          <div class="small" id="lobbyExpiryText"></div>
          <button id="btnKeepLobby" style="margin: 8px 0 0;">Lobby behalten</button>
        </div>
        <div class="small muted" id="hostStartHint" style="margin-top: 8px;">Nur der Host kann das Spiel starten.</div>
      </div>

      <div id="lobbyError" style="margin-top: 10px;"></div>
    </div>
  </div>

  <!-- Spiel-Ansicht: je nach Spieltyp werden unterschiedliche Bereiche sichtbar -->
  <div id="game" style="display:none;">
    <div class="refresh-row">
      <button id="btnReload" class="icon-btn" title="Neu laden" aria-label="Neu laden">ðŸ”„</button>
    </div>
    <h2 id="playerDisplay">Am Zug: -</h2>
    <div class="small muted" id="turnHint"></div>

    <!-- Schocken-Ansicht -->
    <div id="schockenView">
      <div class="dice-container kwyx-dice-container">
        <div class="die" id="die0">â–¡</div>
        <div class="die" id="die1">â–¡</div>
        <div class="die" id="die2">â–¡</div>
      </div>

      <button id="rollBtn">WÃ¼rfeln</button>
      <button id="endTurnBtn" class="btn-secondary">Zug beenden</button>

      <div id="roundDisplay">Runde: 1</div>
      <div id="result"></div>
    </div>

    <!-- Kniffel/Yahtzee-Ansicht -->
    <div id="kniffelView" style="display:none;">
      <div class="dice-container kwyx-dice-container">
        <div class="die" id="kniffelDie0">â–¡</div>
        <div class="die" id="kniffelDie1">â–¡</div>
        <div class="die" id="kniffelDie2">â–¡</div>
        <div class="die" id="kniffelDie3">â–¡</div>
        <div class="die" id="kniffelDie4">â–¡</div>
      </div>

      <button id="kniffelRollBtn">WÃ¼rfeln</button>
      <button id="kniffelEndTurnBtn" class="btn-secondary">Kategorie sichern</button>

      <div id="kniffelResult"></div>
      <div id="kniffelScoreTable" style="margin-top: 14px;"></div>
    </div>

    <!-- Kwyx-Ansicht -->
    <div id="kwyxView" style="display:none;">
      <div class="dice-container kwyx-dice-container">
        <div class="die kwyx-die white" id="kwyxDieWhite0">â–¡</div>
        <div class="die kwyx-die white" id="kwyxDieWhite1">â–¡</div>
        <div class="die kwyx-die red" id="kwyxDieRed">â–¡</div>
        <div class="die kwyx-die yellow" id="kwyxDieYellow">â–¡</div>
        <div class="die kwyx-die green" id="kwyxDieGreen">â–¡</div>
        <div class="die kwyx-die blue" id="kwyxDieBlue">â–¡</div>
      </div>

      <div class="kwyx-card">
        <div class="kwyx-card-title">Deine Punktekarte</div>
        <div id="kwyxCardRows"></div>
      </div>

      <div class="kwyx-actions">
        <div class="kwyx-action-buttons">
          <button id="kwyxRollBtn">WÃ¼rfeln</button>
          <button id="kwyxEndTurnBtn" class="btn-secondary">Zug beenden</button>
        </div>
        <div class="small muted" id="kwyxTurnHint"></div>
      </div>

      <div id="kwyxResult"></div>
      <div class="kwyx-points">
        <div class="small muted" style="margin-bottom: 6px;">PunkteÃ¼bersicht pro Reihe (Schloss zÃ¤hlt als zusÃ¤tzliches Kreuz)</div>
        <table>
          <thead>
            <tr>
              <th>Kreuze</th>
              <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th>
              <th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Punkte</td>
              <td>1</td><td>3</td><td>6</td><td>10</td><td>15</td><td>21</td>
              <td>28</td><td>36</td><td>45</td><td>55</td><td>66</td><td>78</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Schwimmen-Ansicht -->
    <div id="schwimmenView" style="display:none;">
      <div class="small muted">Tischkarten</div>
      <div class="card-row" id="schwimmenTable"></div>

      <div class="small muted">Deine Karten</div>
      <div class="card-row" id="schwimmenHand"></div>

      <div class="card-actions">
        <button id="schwimmenSwapBtn">1 Karte tauschen</button>
        <button id="schwimmenSwapAllBtn">Alle tauschen</button>
        <button id="schwimmenPassBtn" class="btn-secondary">Schieben</button>
        <button id="schwimmenKnockBtn" class="btn-secondary">Klopfen</button>
        <button id="schwimmenNextRoundBtn" style="display:none;">Neue Runde starten</button>
      </div>

      <div id="schwimmenResult"></div>
      <div id="schwimmenScores" style="margin-top: 14px;"></div>
    </div>

    <!-- Schiffe versenken-Ansicht -->
    <div id="schiffeversenkenView" style="display:none;">
      <div id="svMessage" class="sv-message"></div>
      <div id="svSetupArea" style="display:none;">
        <div class="sv-setup-controls">
          <div id="svShipList" class="sv-ship-list"></div>
          <div class="sv-setup-grid-wrap">
            <div class="sv-grid-label">Dein Spielfeld</div>
            <div id="svSetupGrid" class="sv-grid"></div>
          </div>
          <div class="sv-setup-hint">Klicke auf ein Schiff, dann auf das Gitter um es zu platzieren.<br/>
            <button id="svRotateBtn" class="btn-secondary sv-rotate-btn">Drehen (â†”/â†•)</button>
          </div>
        </div>
      </div>
      <div id="svPlayArea" style="display:none;">
        <div class="sv-boards">
          <div class="sv-board-wrap">
            <div class="sv-grid-label">Dein Spielfeld</div>
            <div id="svMyGrid" class="sv-grid sv-grid-own"></div>
          </div>
          <div class="sv-board-wrap">
            <div class="sv-grid-label">Gegner</div>
            <div id="svEnemyGrid" class="sv-grid sv-grid-enemy"></div>
          </div>
        </div>
      </div>
      <div id="svResult" style="margin-top: 10px;"></div>
    </div>

    <!-- Skat-Ansicht -->
    <div id="skatView" style="display:none;">
      <div class="small muted">Skat (3 Spieler)</div>
      <div id="skatBidding" style="margin-top: 10px;"></div>
      <div id="skatPlayers" class="playerList"></div>
      <div id="skatActions" style="margin-top: 10px;"></div>
      <div class="small muted">Stich</div>
      <div class="card-row" id="skatTrick"></div>
      <div class="small muted">Deine Karten</div>
      <div class="card-row" id="skatHand"></div>
      <div class="card-row" id="skatSkat" style="margin-top: 6px;"></div>
      <div id="skatResult" style="margin-top: 10px;"></div>
    </div>

    <div id="historyTable" style="margin-top: 14px;"></div>

    <div id="backToLobbyWrap" style="margin-top: 16px;">
      <button id="btnBackToLobby" class="btn-secondary">ZurÃ¼ck zur Lobby</button>
    </div>
  </div>

  <footer>
    <a class="impressum-link" href="/impressum.html" target="_blank" rel="noopener noreferrer">Impressum</a>
  </footer>

  <!-- Socket.IO Client fÃ¼r Echtzeit-Kommunikation -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/games/kniffel.js"></script>
  <script src="/js/games/kwyx.js"></script>
  <script src="/js/games/schwimmen.js"></script>
  <script src="/js/games/skat.js"></script>
  <script src="/js/games/schocken.js"></script>
  <script src="/js/games/schiffeversenken.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
